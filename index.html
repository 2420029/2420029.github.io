<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { color: #333; }
        .note {
            background: #f4f4f4;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .date { color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>ğŸ“ My Notes</h1>
    
    <div class="note">
        <div class="date">2026-02-15</div>
        <h2>First Note</h2>
        <p>Created a note site with GitHub Pages.</p>
    </div>
    
<div class="note">
    <div class="date">2026-02-16</div>
    <h2>PowerShell Script</h2>
    <pre><code># Apple iOS/iPadOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (PowerShellç‰ˆ)
# æœ€çµ‚æ›´æ–°: 2026-02-15

#Requires -Version 5.1

# è¨­å®š
$OUTPUT_DIR = "C:\AppleVersions"
$HTML_FILE = Join-Path $OUTPUT_DIR "ios-versions.html"
$DATA_FILE = Join-Path $OUTPUT_DIR "version-data.json"
$UPDATE_DISPLAY_DAYS = 14

# å¯¾è±¡URLï¼ˆå¤ã„é †ï¼‰
$TARGETS = @(
    @{Name = "iOS 16"; Url = "https://support.apple.com/ja-jp/101566"},
    @{Name = "iOS 17"; Url = "https://support.apple.com/ja-jp/118723"},
    @{Name = "iOS 18"; Url = "https://support.apple.com/ja-jp/121161"},
    @{Name = "iOS 26"; Url = "https://support.apple.com/ja-jp/123075"},
    @{Name = "iPadOS 16"; Url = "https://support.apple.com/ja-jp/108050"},
    @{Name = "iPadOS 17"; Url = "https://support.apple.com/ja-jp/118702"},
    @{Name = "iPadOS 18"; Url = "https://support.apple.com/ja-jp/121162"},
    @{Name = "iPadOS 26"; Url = "https://support.apple.com/ja-jp/123074"}
)

# å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
if (-not (Test-Path $OUTPUT_DIR)) {
    New-Item -ItemType Directory -Path $OUTPUT_DIR -Force | Out-Null
}

Write-Host "============================================================" -ForegroundColor Cyan
Write-Host "Apple iOS/iPadOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±å–å¾—" -ForegroundColor Cyan
Write-Host "============================================================" -ForegroundColor Cyan

# æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
$versionData = @{}
if (Test-Path $DATA_FILE) {
    try {
        $jsonContent = Get-Content $DATA_FILE -Raw -Encoding UTF8
        $versionData = $jsonContent | ConvertFrom-Json
        # ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¤‰æ›
        $tempData = @{}
        $versionData.PSObject.Properties | ForEach-Object {
            $tempData[$_.Name] = @{
                Version = $_.Value.Version
                UpdateDate = $_.Value.UpdateDate
                PreviousVersion = $_.Value.PreviousVersion
            }
        }
        $versionData = $tempData
    }
    catch {
        Write-Host "âš  ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Yellow
        $versionData = @{}
    }
}

function Extract-Version {
    param(
        [string]$Content,
        [string]$OsName
    )
    
    # OSåã‹ã‚‰ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’é™¤å»
    # ä¾‹: "iOS 17" â†’ "iOS"
    $baseOsName = $OsName -replace '\s+\d+$', ''
    
    # æœŸå¾…ã•ã‚Œã‚‹ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³
    # ä¾‹: "iOS 17" â†’ "17"
    $expectedMajor = $null
    if ($OsName -match '\s+(\d+)$') {
        $expectedMajor = $matches[1]
    }
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³1: <a>ã‚¿ã‚°ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŠ½å‡º
    $linkPattern = "<a[^>]*>\s*$([regex]::Escape($baseOsName))\s+([\d\.]+)\s*</a>"
    $linkMatches = [regex]::Matches($Content, $linkPattern, 'IgnoreCase')
    $linkVersions = @()
    foreach ($match in $linkMatches) {
        $linkVersions += $match.Groups[1].Value
    }
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³2: <h2>ã‚¿ã‚°ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŠ½å‡º
    $h2Pattern = "<h2[^>]*>\s*$([regex]::Escape($baseOsName))\s+([\d\.]+)\s*</h2>"
    $h2Matches = [regex]::Matches($Content, $h2Pattern, 'IgnoreCase')
    $h2Versions = @()
    foreach ($match in $h2Matches) {
        $h2Versions += $match.Groups[1].Value
    }
    
    # ä¸¡æ–¹ã®ãƒãƒƒãƒã‚’çµåˆï¼ˆé‡è¤‡å‰Šé™¤ï¼‰
    $allVersions = ($linkVersions + $h2Versions) | Select-Object -Unique
    
    if ($allVersions.Count -eq 0) {
        return $null
    }
    
    # ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãƒ•ã‚£ãƒ«ã‚¿
    if ($expectedMajor) {
        $filteredVersions = $allVersions | Where-Object { $_ -match "^$expectedMajor\." }
        
        if ($filteredVersions.Count -eq 0) {
            return $null
        }
        
        # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚½ãƒ¼ãƒˆã—ã¦æœ€æ–°ã‚’å–å¾—
        $sortedVersions = $filteredVersions | Sort-Object {
            [version]($_ -replace '^(\d+\.\d+(?:\.\d+)?).*', '$1')
        }
        
        return $sortedVersions[-1]
    }
    
    return $allVersions[0]
}

function Fetch-Version {
    param($Target)
    
    $name = $Target.Name
    $url = $Target.Url
    
    Write-Host "å–å¾—ä¸­: $name - $url"
    
    try {
        # ãƒ–ãƒ©ã‚¦ã‚¶ã®User-Agentã‚’è¨­å®š
        $headers = @{
            'User-Agent' = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
            'Accept' = 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'
            'Accept-Language' = 'ja,en-US;q=0.7,en;q=0.3'
        }
        
        $response = Invoke-WebRequest -Uri $url -Headers $headers -TimeoutSec 30 -UseBasicParsing
        $content = $response.Content
        
        $version = Extract-Version -Content $content -OsName $name
        
        if (-not $version) {
            Write-Host "âš  $name : ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ" -ForegroundColor Yellow
            $version = "å–å¾—å¤±æ•—"
        }
        
        return @{
            Name = $name
            Version = $version
            Url = $url
            Success = ($version -ne "å–å¾—å¤±æ•—")
        }
    }
    catch {
        Write-Host "âš  $name ã®å–å¾—ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Yellow
        return @{
            Name = $name
            Version = "å–å¾—ã‚¨ãƒ©ãƒ¼"
            Url = $url
            Success = $false
        }
    }
}

# å„URLã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—
$results = @()
foreach ($target in $TARGETS) {
    $result = Fetch-Version -Target $target
    $results += $result
}

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
$now = Get-Date
foreach ($result in $results) {
    if (-not $result.Success) {
        continue
    }
    
    $name = $result.Name
    $version = $result.Version
    
    # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒ
    $isUpdated = $false
    $updateDate = ""
    $previousVersion = ""
    
    if ($versionData.ContainsKey($name)) {
        $oldVersion = $versionData[$name].Version
        if ($version -ne $oldVersion) {
            $isUpdated = $true
            $updateDate = $now.ToString("yyyy/M/d")
            $previousVersion = $oldVersion
            
            # ãƒ‡ãƒ¼ã‚¿æ›´æ–°
            $versionData[$name] = @{
                Version = $version
                UpdateDate = $updateDate
                PreviousVersion = $previousVersion
            }
        }
        else {
            # æ—¢å­˜ã®æ›´æ–°æ—¥ã‚’ä¿æŒ
            $updateDate = $versionData[$name].UpdateDate
            $previousVersion = $versionData[$name].PreviousVersion
        }
    }
    else {
        # æ–°è¦è¿½åŠ 
        $updateDate = $now.ToString("yyyy/M/d")
        $versionData[$name] = @{
            Version = $version
            UpdateDate = $updateDate
            PreviousVersion = ""
        }
        $isUpdated = $true
    }
    
    # çµæœã«æ›´æ–°æƒ…å ±ã‚’è¿½åŠ 
    $result.IsUpdated = $isUpdated
    $result.UpdateDate = $updateDate
}

# JSONãƒ‡ãƒ¼ã‚¿ä¿å­˜
try {
    $versionData | ConvertTo-Json -Depth 10 | Out-File $DATA_FILE -Encoding UTF8
}
catch {
    Write-Host "âš  ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Yellow
}

# HTMLç”Ÿæˆ
function Generate-Html {
    param($Results)
    
    $now = Get-Date -Format "yyyy/M/d HH:mm:ss"
    
    # iOSã¨iPadOSã«åˆ†é¡
    $iosResults = $Results | Where-Object { $_.Name -like "iOS *" }
    $ipadosResults = $Results | Where-Object { $_.Name -like "iPadOS *" }
    
    function Generate-Rows {
        param($ResultsList)
        
        $rows = @()
        foreach ($result in $ResultsList) {
            $name = $result.Name
            $version = $result.Version
            $url = $result.Url
            $isUpdated = $result.IsUpdated
            $updateDate = $result.UpdateDate
            
            $versionClass = if ($result.Success) { "version" } else { "error" }
            $updateBadge = ""
            
            # æ›´æ–°ãƒãƒƒã‚¸è¡¨ç¤ºåˆ¤å®šï¼ˆ14æ—¥ä»¥å†…ï¼‰
            if ($isUpdated -and $updateDate) {
                try {
                    $updateDateTime = [DateTime]::ParseExact($updateDate, "yyyy/M/d", $null)
                    $daysSinceUpdate = ($now - $updateDateTime).Days
                    if ($daysSinceUpdate -le $UPDATE_DISPLAY_DAYS) {
                        $updateBadge = "<span class='update-badge'>ğŸ“¢ $updateDate ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚ã‚Š</span>"
                    }
                }
                catch {}
            }
            
            $rows += @"
            <tr>
                <td class="os-name">$name</td>
                <td>
                    <span class="$versionClass">$version</span>
                    $updateBadge
                </td>
                <td><a href="$url" target="_blank">è©³ç´°ã‚’è¦‹ã‚‹</a></td>
            </tr>
"@
        }
        
        return $rows -join "`n"
    }
    
    $iosRowsHtml = Generate-Rows -ResultsList $iosResults
    $ipadosRowsHtml = Generate-Rows -ResultsList $ipadosResults
    
    $html = @"
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple iOS/iPadOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f7;
        }
        h1 {
            color: #1d1d1f;
            text-align: center;
            margin-bottom: 10px;
        }
        .update-time {
            text-align: center;
            color: #6e6e73;
            font-size: 14px;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th {
            background-color: #007aff;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        td {
            padding: 15px;
            border-bottom: 1px solid #e5e5e7;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .version {
            font-weight: 600;
            font-size: 16px;
            color: #1d1d1f;
        }
        .update-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff3b30 0%, #ff6b6b 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(255, 59, 48, 0.3);
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .os-name {
            font-weight: 500;
            color: #424245;
        }
        .error {
            color: #ff3b30;
            font-style: italic;
        }
        a {
            color: #007aff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #6e6e73;
            font-size: 12px;
        }
        h2 {
            color: #1d1d1f;
            font-size: 20px;
            margin-top: 40px;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #007aff;
        }
        h2:first-of-type {
            margin-top: 0;
        }
        .table-section {
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <h1>ğŸ Apple iOS/iPadOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±</h1>
    <div class="update-time">æœ€çµ‚æ›´æ–°: $now</div>
    
    <div class="table-section">
        <h2>ğŸ“± iOS</h2>
        <table>
            <thead>
                <tr>
                    <th>OS</th>
                    <th>æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³</th>
                    <th>è©³ç´°</th>
                </tr>
            </thead>
            <tbody>
$iosRowsHtml
            </tbody>
        </table>
    </div>
    
    <div class="table-section">
        <h2>ğŸ“² iPadOS</h2>
        <table>
            <thead>
                <tr>
                    <th>OS</th>
                    <th>æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³</th>
                    <th>è©³ç´°</th>
                </tr>
            </thead>
            <tbody>
$ipadosRowsHtml
            </tbody>
        </table>
    </div>
    
    <div class="footer">
        â€»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—é€šçŸ¥ã¯æ›´æ–°ã‹ã‚‰${UPDATE_DISPLAY_DAYS}æ—¥é–“è¡¨ç¤ºã•ã‚Œã¾ã™<br>
        ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: $DATA_FILE
    </div>
</body>
</html>
"@
    
    return $html
}

# HTMLç”Ÿæˆã¨ä¿å­˜
$html = Generate-Html -Results $results
try {
    $html | Out-File $HTML_FILE -Encoding UTF8
    Write-Host ""
    Write-Host "============================================================" -ForegroundColor Green
    Write-Host "âœ… å®Œäº†: $HTML_FILE" -ForegroundColor Green
    Write-Host "ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: $DATA_FILE" -ForegroundColor Green
    Write-Host "============================================================" -ForegroundColor Green
}
catch {
    Write-Host "âš  HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)" -ForegroundColor Red
}</code></pre>
</div>
    
</body>
</html>
